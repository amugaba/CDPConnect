<?xml version="1.0" encoding="utf-8"?>
<assessment:InterviewForm xmlns:fx="http://ns.adobe.com/mxml/2009" 
			 xmlns:s="library://ns.adobe.com/flex/spark" 
			 xmlns:mx="library://ns.adobe.com/flex/mx" width="100%" height="100%" xmlns:assessment="components.assessment.*">
	<fx:Script>
		<![CDATA[
			import components.assessment.InterviewType;
			import components.questions.QuestionClass;
			import components.questions.QuestionList;
			import components.questions.QuestionText;
			import components.validators.DateAgeValidator;
			import components.validators.Valid;
			
			import flash.globalization.DateTimeFormatter;
			import flash.globalization.LocaleID;
			
			import mx.collections.ArrayList;
			
			public var qClientID:QuestionText = new QuestionText("ClientID","Client ID","",false);
			public var qClientType:QuestionList = new QuestionList("ClientType","Client Type",new ArrayList(["Treatment Client","Client in Recovery"]),0);
			public var qInterviewTypeCode:QuestionList = new QuestionList("InterviewTypeCode","Interview Type",new ArrayList(["Intake","6 Month Followup","12 Month Followup","3 Month Followup","Discharge"]),0);
			public var qConductedInterview:QuestionList = new QuestionList("ConductedInterview","Did you conduct a followup/discharge interview?",yn,0);
			public var qInterviewDate:QuestionText = new QuestionText("InterviewDate","Interview Date","");
			public var qCooccurringScreen:QuestionList = new QuestionList("CooccurringScreen","Was the client screened by your program for co-occurring mental health and substance use disorders?",yn,1);
			public var qCooccurringScreenStatus:QuestionList = new QuestionList("CooccurringScreenStatus","Did the client screen positive for co-occurring mental health and substance use disorders?",yn,1);
			public var qFollowupSelected:QuestionList = new QuestionList("followupSelected","Was the client selected for follow-up, and did the client agree to follow-up?",yn,1);

			protected var dateFormatter:DateTimeFormatter = new DateTimeFormatter(LocaleID.DEFAULT);
			
			//Record Form Area
			public override function createForm():void
			{
				//Questions
				addQuestion(qClientID);
				qClientID.answerType = String;
				addQuestion(qClientType, 150);
				addQuestion(qInterviewTypeCode, 150);
				addQuestion(qConductedInterview);
				addQuestion(qInterviewDate);
				addQuestion(qCooccurringScreen);
				addQuestion(qCooccurringScreenStatus);
				addQuestion(qFollowupSelected);
				
				//Validators
				Valid.addDateAgeValidator(qInterviewDate,0,DateAgeValidator.DAY,365,DateAgeValidator.DAY);
				qInterviewDate.answerType = String;
				
				//Control Logic
				addSkipDropDown(qInterviewTypeCode,["Intake"],[qConductedInterview]);
				addSkipDropDown(qConductedInterview,[NO_VALUE],[qInterviewDate]);
				addSkipDropDown(qCooccurringScreen,[NO_VALUE],[qCooccurringScreenStatus]);
				
				//Prepopulate
				dateFormatter.setDateTimePattern("MM/dd/yyyy");
				populateForm();
			}
			
			public function populateForm():void
			{
				qClientID.answer = String(global.activeClient.clientid);
				qInterviewDate.answer = dateFormatter.format(new Date());
				qFollowupSelected.visible = false;
				
				if(InterviewType.isIntake(global.pageGPRA.interviewType))
				{
					qInterviewTypeCode.answer = "Intake";
					qFollowupSelected.visible = true;
				}
				else if(InterviewType.isFollowup(global.pageGPRA.interviewType))
					qInterviewTypeCode.answer = "6 Month Followup";
				else if(InterviewType.DISCHARGE_BI == global.pageGPRA.interviewType || InterviewType.DISCHARGE_RT == global.pageGPRA.interviewType)
				{
					qInterviewTypeCode.answer = "Discharge";
					qConductedInterview.answer = "Yes";
					qConductedInterview.refreshSkips();
				}
				else if(InterviewType.DISCHARGE_ADMIN== global.pageGPRA.interviewType)
				{
					qInterviewTypeCode.answer = "Discharge";
					qConductedInterview.answer = "No";
					qConductedInterview.refreshSkips();
				}
			}
			
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
</assessment:InterviewForm>
