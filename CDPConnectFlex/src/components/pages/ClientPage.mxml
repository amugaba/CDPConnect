<?xml version="1.0" encoding="utf-8"?>
<s:NavigatorContent xmlns:fx="http://ns.adobe.com/mxml/2009"
					xmlns:s="library://ns.adobe.com/flex/spark"
					xmlns:mx="library://ns.adobe.com/flex/mx"
					xmlns:custom="components.*"
					xmlns:gpraservice="services.gpraservice.*"
					xmlns:styles="com.adobe.fiber.styles.*"
					xmlns:clientservice="services.clientservice.*"
					width="715" height="800" xmlns:questions="components.questions.*" xmlns:client="components.client.*">
	<fx:Script>
		<![CDATA[
			import components.dci.InterviewType;
			import components.questions.QuestionList;
			import components.questions.QuestionText;
			import components.validators.DateAgeValidator;
			import components.validators.Valid;
			
			import flash.globalization.DateTimeFormatter;
			import flash.globalization.LocaleID;
			
			import mx.collections.ArrayCollection;
			import mx.collections.ArrayList;
			import mx.controls.Alert;
			import mx.controls.DateField;
			import mx.controls.Text;
			import mx.core.FlexGlobals;
			import mx.effects.effectClasses.AddRemoveEffectTargetFilter;
			import mx.events.CloseEvent;
			import mx.events.ValidationResultEvent;
			import mx.rpc.events.ResultEvent;
			import mx.validators.ValidationResult;
			import mx.validators.Validator;
			
			import valueObjects.ClientVO;
			import valueObjects.GpraVO;
			
			[Bindable] protected var clientGPRAs:ArrayCollection = new ArrayCollection();
			protected var global:CDPConnectFlex = FlexGlobals.topLevelApplication as CDPConnectFlex;
			
			public function initializePage():void
			{
				clientGroup.initializeGroup();
				episodeGroup.initializeGroup();
			}		
			
			
			/*
			
			protected function loadGpraButton_clickHandler(event:MouseEvent):void
			{
				if(assessmentGrid.selectedIndex > -1)
				{
					global.activeGPRA = assessmentGrid.selectedItem as GpraVO;
					getGpraByIDResult.token = gpraService.getGpraByID(global.activeGPRA.autoid);
				}
			}
			protected function getGpraByIDResult_resultHandler(event:ResultEvent):void
			{
				if(getGpraByIDResult.lastResult != null)
				{
					//global.pageGPRA.initializeGPRA();
					global.activeGPRA.data = getGpraByIDResult.lastResult;
					//global.pageGPRA.populateForm(global.activeGPRA.data);
					global.pageViewstack.selectedChild = global.pageGPRA;
					global.pageGpraButton.enabled = true;
				}
				else
					Alert.show("GPRA not found with this ID.");
			}
			
			protected function createNegativeIntakeButton_clickHandler(event:MouseEvent):void
			{
				if(global.activeClient == null)
					Alert.show("Add or load a client first.");
				else if(global.activeClient.intake != null)
					Alert.show("A GPRA intake already exists.");
				else
				{
					var g:GpraVO = new GpraVO();
					g.autoid = -1;
					g.type = InterviewType.INTAKE_SBIRT_NEG;
					g.status = 0;
					g.clientid = global.activeClient.autoid;
					global.activeGPRA = g;
					//global.pageViewstack.selectedChild = global.pageGPRA;
					global.pageGpraButton.enabled = true;
					//global.pageGPRA.initializeGPRA();
				}	
			}
			
			protected function createBIIntakeButton_clickHandler(event:MouseEvent):void
			{
				if(global.activeClient == null)
					Alert.show("Add or load a client first.");
				//else if(global.activeClient.intake != null)
				//	Alert.show("A GPRA intake already exists.");
				else
				{
					var g:GpraVO = new GpraVO();
					g.autoid = -1;
					g.type = InterviewType.INTAKE_SBIRT_BI;
					g.status = 0;
					g.clientid = global.activeClient.autoid;
					global.activeGPRA = g;
					//global.pageViewstack.selectedChild = global.pageGPRA;
					global.pageGpraButton.enabled = true;
					//global.pageGPRA.initializeGPRA();
				}	
			}
			
			protected function getGpraSummaryByClientIDResult_resultHandler(event:ResultEvent):void
			{
				global.activeClient.gpras = getGpraSummaryByClientIDResult.lastResult;
				clientGPRAs = getGpraSummaryByClientIDResult.lastResult;
				
				global.activeClient.intake = null;
				global.activeClient.followup = null;
				global.activeClient.discharge = null;
				for each(var g:GpraVO in clientGPRAs)
				{
					if(g.type == 1)
					{
						global.activeClient.intake = g;
						getIntakeData.token = gpraService.getGpraByID(g.autoid);
					}
					else if(g.type == 2)
						global.activeClient.followup = g;
					else if(g.type == 5)
						global.activeClient.discharge = g;
				}
			}
			
			protected function createDischargeButton_clickHandler(event:MouseEvent):void
			{
				if(global.activeClient == null)
					Alert.show("Add or load a client first.");
				else if(global.activeClient.intake == null)
					Alert.show("Create a GPRA intake first.");
				else if(global.activeClient.discharge != null)
					Alert.show("A GPRA discharge already exists.");
				else
				{
					var g:GpraVO = new GpraVO();
					g.autoid = -1;
					g.type = 5;
					g.status = 0;
					g.clientid = global.activeClient.autoid;
					global.activeGPRA = g;
					//global.pageViewstack.selectedChild = global.pageGPRA;
					global.pageGpraButton.enabled = true;
					//global.pageGPRA.initializeGPRA();
				}	
			}
			
			protected function createFollowupButton_clickHandler(event:MouseEvent):void
			{
				if(global.activeClient == null)
					Alert.show("Add or load a client first.");
				else if(global.activeClient.intake == null)
					Alert.show("Create a GPRA intake first.");
				else if(global.activeClient.followup != null)
					Alert.show("A GPRA followup already exists.");
				else
				{
					var g:GpraVO = new GpraVO();
					g.autoid = -1;
					g.type = 2;
					g.status = 0;
					g.clientid = global.activeClient.autoid;
					global.activeGPRA = g;
					//global.pageViewstack.selectedChild = global.pageGPRA;
					global.pageGpraButton.enabled = true;
					//global.pageGPRA.initializeGPRA();
				}
			}
			*/
			protected function getIntakeData_resultHandler(event:ResultEvent):void
			{
				global.activeClient.intake.data = getIntakeData.lastResult;
			}
			
		]]>
	</fx:Script>
	<fx:Style> 
		@namespace s "library://ns.adobe.com/flex/spark"; 
		@namespace mx "library://ns.adobe.com/flex/mx"; 
		@namespace components "components.*"; 

	</fx:Style>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<!--<s:CallResponder id="getGpraByIDResult" result="getGpraByIDResult_resultHandler(event)"/>
		<s:CallResponder id="getGpraSummaryByClientIDResult" result="getGpraSummaryByClientIDResult_resultHandler(event)"/>-->
		<s:CallResponder id="getIntakeData" result="getIntakeData_resultHandler(event)"/>
		<gpraservice:GpraService id="gpraService"
								 fault="Alert.show(event.fault.faultString + '\n' + event.fault.faultDetail)"
								 showBusyCursor="true"/>

		
	</fx:Declarations>
	<client:ClientGroup id="clientGroup" x="0" y="0" />
	<mx:HRule x="10" y="223" width="695" height="20"/>
	<client:EpisodeGroup id="episodeGroup" x="0" y="240" />
	<mx:HRule x="10" y="454" width="695" height="20"/>
	<!-- Assessments Area -->
	<s:DataGrid id="assessmentGrid" x="9" y="506" width="289" height="194"
				dataProvider="{clientGPRAs}" itemRenderer="components.gpraGridRenderer"
				requestedRowCount="3" resizableColumns="false">
		<s:columns>
			<s:ArrayList>
				<s:GridColumn dataField="type" headerText="Type" width="100"></s:GridColumn>
				<s:GridColumn dataField="date" headerText="Date" width="70"></s:GridColumn>
				<s:GridColumn dataField="status" headerText="Done" width="50"></s:GridColumn>
				<s:GridColumn dataField="load" headerText="Load" width="60"></s:GridColumn>
			</s:ArrayList>
		</s:columns>
		<s:typicalItem>
			<fx:Object type="Intake" date="5/22/2013"></fx:Object>
		</s:typicalItem>
	</s:DataGrid>
	<s:Button id="sbirtIntakeNegativeButton" x="418" y="540"
			  label="SBIRT - Neg"/>
	<s:Button id="sbirtIntakeBIButton" x="423" y="580"
			  label="SBIRT - BI" />
	<s:Button id="dischargeGeneralButton" x="536" y="505"
			  label="General"/>
	<s:Button id="followupGeneralButton" x="633" y="505"
			  label="General" />

	
	
	<s:Label x="102" y="480" fontWeight="bold" text="Assessments List"/>
	<mx:VRule x="302" y="464" width="14" height="231"/>
	<mx:VRule x="398" y="463" width="14" height="231"/>
	<s:Label x="328" y="481" fontWeight="bold" text="Screening"/>
	<s:Label x="433" y="478" fontWeight="bold" text="DCI Intake"/>
	<s:Label x="533" y="477" fontWeight="bold" text="DCI Discharge"/>
	<s:Label x="634" y="478" fontWeight="bold" text="DCI Followup"/>
	<s:Button id="prescreenButton" x="318" y="503" label="Prescreen"/>
	<s:Button id="auditButton" x="320" y="542" label="AUDIT"/>
	<s:Button id="dast10Button" x="320" y="581" label="DAST-10"/>
	<s:Button id="phq9Button" x="320" y="621" label="PHQ9"/>
	<s:Button id="intakeGeneralButton" x="426" y="503" label="General"/>
	<s:Button id="sbirtIntakeRTButton" x="412" y="621" label="SBIRT - BT/RT"/>
	<mx:VRule x="513" y="463" width="14" height="231"/>
	<s:Button id="dischargeNoInterviewButton" x="528" y="541" label="No Interview"/>
	<s:Button id="sbirtFollowupButton" x="631" y="541"
			  label="SBIRT - BI" />
	<mx:VRule x="617" y="463" width="14" height="231"/>

</s:NavigatorContent>
